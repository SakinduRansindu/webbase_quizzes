<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Quiz Zone</title>
  <style>
    body { 
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
      padding: 20px; 
      background-color: #f5f5f5;
      margin: 0;
    }
    .container {
      max-width: 900px;
      margin: 0 auto;
      background-color: white;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      padding: 20px;
    }
    .header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding-bottom: 20px;
      border-bottom: 1px solid #eee;
      margin-bottom: 20px;
    }
    .back-btn {
      background-color: #4a6eb5;
      color: white;
      border: none;
      padding: 8px 15px;
      border-radius: 4px;
      cursor: pointer;
      font-weight: bold;
      transition: background-color 0.2s;
      text-decoration: none;
      display: inline-block;
    }
    .back-btn:hover {
      background-color: #3a5995;
    }
    .question-block { 
      border: 1px solid #eee; 
      border-radius: 6px;
      padding: 20px; 
      margin-bottom: 25px;
      background-color: #fff;
      box-shadow: 0 1px 3px rgba(0,0,0,0.05);
    }
    .question { 
      margin-bottom: 15px; 
      font-size: 1.1rem;
      line-height: 1.5;
    }
    .question code {
      font-family: monospace;
      background-color: #f8f8f8;
      padding: 2px 5px;
      border-radius: 3px;
      font-size: 0.9em;
    }
    .choices { 
      margin-bottom: 15px; 
    }
    .choices label {
      display: block;
      padding: 10px;
      margin: 5px 0;
      background-color: #f8f8f8;
      border-radius: 4px;
      cursor: pointer;
      transition: background-color 0.2s;
    }
    .choices label:hover {
      background-color: #eaeaea;
    }
    .result { 
      font-weight: bold; 
      margin-top: 15px; 
      padding: 10px;
      border-radius: 4px;
    }
    .justification { 
      margin-top: 10px; 
      display: none; 
      background-color: #f8f8f8;
      padding: 10px;
      border-radius: 4px;
      line-height: 1.4;
    }
    .pagination { 
      text-align: center; 
      margin-top: 30px; 
      display: flex;
      justify-content: center;
      align-items: center;
    }
    .pagination button { 
      margin: 0 10px; 
      padding: 10px 20px;
      background-color: #4a6eb5;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-weight: bold;
      transition: background-color 0.2s;
    }
    .pagination button:hover {
      background-color: #3a5995;
    }
    .pagination button:disabled {
      background-color: #ccc;
      cursor: not-allowed;
    }
    #page-indicator {
      margin: 0 15px;
      font-weight: bold;
    }
    pre code {
      display: block;
      background-color: #f8f8f8;
      padding: 15px;
      border-radius: 5px;
      overflow-x: auto;
      font-family: monospace;
      line-height: 1.4;
    }    .category-badge {
      background-color: #4a6eb5;
      color: white;
      padding: 5px 10px;
      border-radius: 20px;
      font-size: 0.9rem;
      margin-left: 10px;
    }
    
    .category-info {
      background-color: #f0f4f9;
      padding: 10px 15px;
      border-radius: 6px;
      font-size: 0.9rem;
      color: #333;
      margin: 10px 0;
      line-height: 1.5;
      border-left: 4px solid #4a6eb5;
    }
    .options-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      padding: 10px 15px;
      background-color: #f8f8f8;
      border-radius: 4px;
    }
    .shuffle-btn {
      background-color: #4CAF50;
      color: white;
      border: none;
      padding: 8px 15px;
      border-radius: 4px;
      cursor: pointer;
      font-weight: bold;
      transition: background-color 0.2s;
    }
    .shuffle-btn:hover {
      background-color: #45a049;
    }
    footer {
      text-align: center;
      margin-top: 30px;
      padding-top: 15px;
      border-top: 1px solid #eee;
      color: #777;
      font-size: 0.9rem;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>Quiz Zone <span id="category-badge" class="category-badge">Category</span></h1>
      <a href="index.html" class="back-btn">Back to Categories</a>
    </div>
    
    <div class="options-bar">
      <div>
        <span id="question-count"></span> questions loaded
      </div>
      <button class="shuffle-btn" onclick="toggleShuffle()">Shuffle Questions</button>
    </div>
    
    <div id="quiz-container"></div>
    <div class="pagination">
      <button id="prev-btn" onclick="prevPage()">Previous</button>
      <span id="page-indicator"></span>
      <button id="next-btn" onclick="nextPage()">Next</button>
    </div>
    
    <footer>
      Quiz Zone &copy; 2025 | Educational purpose only
    </footer>
  </div>

  <script src="js/utils.js"></script>
  <script>
  const questionsPerPage = 10;
  let allQuestions = [];
  let currentPage = 1;
  let shuffleMode = false;
  
  // Get the category parameter from URL
  const urlParams = new URLSearchParams(window.location.search);
  const category = urlParams.get('q');
  const initialShuffle = urlParams.get('shuffle') === 'true';
  
  // Set title and category badge
  document.title = `Quiz Zone - ${category ? category.toUpperCase() : 'All Quizzes'}`;
    // Update category badge in header
  document.addEventListener('DOMContentLoaded', () => {
    const categoryBadge = document.getElementById('category-badge');
    if (categoryBadge) {
      categoryBadge.textContent = category ? category.toUpperCase() : 'All Quizzes';
    }
    
    // Try to get category info from session storage
    try {
      const categoryInfo = JSON.parse(sessionStorage.getItem('categoryInfo'));
      if (categoryInfo && categoryInfo.id === category) {
        // Update page with category information
        document.title = `${categoryInfo.name} - Quiz Zone`;
        if (categoryBadge) {
          categoryBadge.textContent = categoryInfo.subject.name;
        }          // Add category info to the header if it exists
        const header = document.querySelector('.header');
        if (header && categoryInfo) {
          const infoElement = document.createElement('div');
          infoElement.className = 'category-info';
          
          // Create subject info element
          const subjectDiv = document.createElement('div');
          const subjectStrong = document.createElement('strong');
          subjectStrong.textContent = 'Subject:';
          subjectDiv.appendChild(subjectStrong);
          subjectDiv.appendChild(document.createTextNode(' ' + categoryInfo.subject.name + ' (' + categoryInfo.subject.code + ')'));
          
          // Create semester info element
          const semesterDiv = document.createElement('div');
          const semesterStrong = document.createElement('strong');
          semesterStrong.textContent = 'Semester:';
          semesterDiv.appendChild(semesterStrong);
          semesterDiv.appendChild(document.createTextNode(' ' + categoryInfo.semester));
          
          // Append elements to container
          infoElement.appendChild(subjectDiv);
          infoElement.appendChild(semesterDiv);
          
          header.insertBefore(infoElement, header.querySelector('a.back-btn'));
        }
      }
    } catch (e) {
      console.error('Error retrieving category info:', e);
    }
    
    // Initialize shuffle if needed
    if (initialShuffle) {
      shuffleMode = true;
      document.querySelector('.shuffle-btn').textContent = 'Ordered Questions';
    }
  });

  async function loadAllQuestions() {
    if (!category) {
      showNotification("No category specified! Redirecting to categories page.", "error");
      setTimeout(() => window.location.href = "index.html", 2000);
      return;
    }
      let index = 1;
    while (true) {
      try {
        // Load from the specific category folder within categories directory
        const module = await import(`./categories/${category}/q${index}.js`);
        console.log(`Loaded categories/${category}/q${index}.js`);
        allQuestions.push(...module.default);
        index++;
      } catch (e) {
        console.log(`Stopped loading at categories/${category}/q${index}.js`, e.message);
        break;
      }
    }
    
    // Apply initial shuffle if needed
    if (initialShuffle) {
      shuffleArray(allQuestions);
    }
    
    // Update question count
    document.getElementById('question-count').textContent = allQuestions.length;
    
    renderPage();
  }

  function toggleShuffle() {
    shuffleMode = !shuffleMode;
    const shuffleBtn = document.querySelector('.shuffle-btn');
    
    if (shuffleMode) {
      shuffleBtn.textContent = 'Ordered Questions';
      shuffleArray(allQuestions);
      showNotification("Questions shuffled", "success");
    } else {
      shuffleBtn.textContent = 'Shuffle Questions';
      // Reset to original order by reloading
      window.location.href = `quiz.html?q=${category}`;
      return;
    }
    
    currentPage = 1;
    renderPage();
  }

  function renderPage() {
    const container = document.getElementById("quiz-container");
    container.innerHTML = "";

    const start = (currentPage - 1) * questionsPerPage;
    const end = start + questionsPerPage;
    const pageQuestions = allQuestions.slice(start, end);

    pageQuestions.forEach((data, index) => {
      const qNum = start + index + 1;
      const resultId = `result-${qNum}`;
      const justId = `just-${qNum}`;

      const block = document.createElement("div");
      block.className = "question-block";
      block.innerHTML = `
        <div class="question">
          <strong>Q${qNum}:</strong> ${data.question}
          ${data.code ? `<pre><code>${data.code}</code></pre>` : ""}
        </div>
        <div class="choices">
          ${data.choices.map((choice, idx) => `
            <label>
              <input type="radio" name="choice-${qNum}" value="${idx}" onclick="checkAnswer(${idx}, ${data.correct}, '${data.justification.replace(/'/g, "\\'")}', '${resultId}', '${justId}')">
              ${choice}
            </label><br>`).join('')}
        </div>
        <div class="result" id="${resultId}"></div>
        <div class="justification" id="${justId}"></div>
      `;
      container.appendChild(block);
    });

    // Update page indicator and button states
    const totalPages = Math.ceil(allQuestions.length / questionsPerPage);
    document.getElementById("page-indicator").textContent = `Page ${currentPage} of ${totalPages}`;
    
    document.getElementById("prev-btn").disabled = currentPage === 1;
    document.getElementById("next-btn").disabled = currentPage === totalPages;
  }

  function checkAnswer(selected, correct, justification, resultId, justId) {
    const result = document.getElementById(resultId);
    const just = document.getElementById(justId);
    if (selected === correct) {
      result.textContent = 'Correct!';
      result.style.color = 'green';
    } else {
      result.textContent = 'Wrong!';
      result.style.color = 'red';
    }
    just.textContent = 'Justification: ' + justification;
    just.style.display = 'block';
  }

  function prevPage() {
    if (currentPage > 1) {
      currentPage--;
      renderPage();
      window.scrollTo(0, 0);
    }
  }

  function nextPage() {
    const maxPage = Math.ceil(allQuestions.length / questionsPerPage);
    if (currentPage < maxPage) {
      currentPage++;
      renderPage();
      window.scrollTo(0, 0);
    }
  }

  // Load questions when page loads
  window.addEventListener('DOMContentLoaded', loadAllQuestions);
  </script>
</body>
</html>
